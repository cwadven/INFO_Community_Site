{% extends 'accountlayout/profilelayer.html' %}
{% block name %}
<script>
function modify_profile() {
  var r = confirm("수정된 정보로 적용하시겠습니까?");
  if (r == true) {
    return true;
  } else {
    return false;
  }
}

function rematch(x){
    var nickname_check;
    if (x=="nickname_id") {
        nickname_check = false
        $('#nickname_check').text("중복된 확인을 해주세요!");
        $('#nickname_check').css("color", "red");
    }
    $('#modify_submit').attr("disabled", true);
    $('#overlap_id').text("중복확인을 해주세요!");
}

function modify_overlap(x, region){
    $.ajax({
        // type을 설정합니다.
        type : 'GET',
        url : "{% url 'account:ajax' 'abc' 'region' %}".replace(/abc/, x.toString()).replace(/region/, region.toString()),
        success : function (data) {
            // 만약 주는 녀석이 region에 따른 녀석이면 region에 따른 녀석만 변경
            if(data["check"]){
                if (region == "nickname"){
                    $('#nickname_check').text("중복된 닉네임이 존재합니다");
                    $('#nickname_check').css("color", "red");
                    nickname_check = false;
                }
            } else {
                if  (region == "nickname"){
                    $('#nickname_check').text("사용 가능한 닉네임 입니다");
                    $('#nickname_check').css("color", "blue");
                    nickname_check = true;
                }
            }
        },
        error: function () { 
            if (region == "nickname"){
                $('#nickname_check').text("닉네임을 입력해주세요");
                nickname_check = false;
            }
        },
        complete: function() {
            if (nickname_check){
                $('#modify_submit').attr("disabled", false);
            } else {
                $('#modify_submit').attr("disabled", true);
                $('#overlap_id').text("중복확인을 해주세요!");
            }
        }
    });
    }

</script>
<h4>개인 정보</h4>

<p>사진 : {% if user.profile.Image %}<img width="100" height="100" src="{{user.profile.Image.url}}">{% else %}설정하지 않았습니다!{% endif %}</p>
<p>닉네임 : {{user.profile.Name}}</p>
<p>이메일 : {{user.profile.Email}}</p>
<p><a href="#">알림설정</a></p>
<p><a href="{% url 'account:like_board' %}">좋아요한 게시판</a></p>
<p><a href="#">즐겨찾기</a></p>

<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal" data-whatever="@mdo">개인정보 수정</button>
    
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">정보 수정</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <form onSubmit="return modify_profile()" action="{% url 'account:profile' %}" enctype="multipart/form-data" method="post">
                {% csrf_token %}
                {{profile_form.as_p}}
                <span id="nickname_check"></span>
                <input type="button" onclick="modify_overlap($('#nickname_id').val(), 'nickname');" value="닉네임 중복확인">
        </div>
                <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">취소</button>
                <button id="modify_submit" type="submit" class="btn btn-primary">수정</button>
                </div>
            </form>
      </div>
    </div>
  </div>

{% endblock %}